#!/bin/bash

DIFF="$(git diff)"

if [[ "$DIFF" != "" ]]; then
  # There are differences
  echo "$DIFF"
  echo -n "There are differences between the local configs and the remote configs. Push changes? [y/N]"
  read answer
  if [[ "$answer" == "y" ]]; then
    git add . && git commit -m "Autoupdate config: $(date)"
    git push origin master
    if [[ "$?" != "0" ]]; then
      echo "Error pushing to master."
      exit $?
    fi
  fi
fi

git pull origin master

DOTFILES_PATH="$(pwd)"

if [ -e ~/.bashrc ]; then
    PROFILE=~/.bashrc
elif [ -e ~/.bash_profile  ]; then
    PROFILE=~/.bash_profile
else
    PROFILE=/dev/null
fi

if [[ "$OSTYPE" == "linux-gnu" ]]; then
    cat ~/.bashrc           >> ~/.bashrc.bak
    cat ~/.config/i3/config >> ~/.config/i3/config.bak

    ln -svf 	$DOTFILES_PATH/bash 	        ~/.bashrc
    ln -svf 	$DOTFILES_PATH/i3		          ~/.config/i3/config
fi
if [[ "$OSTYPE" == "darwin"* ]]; then
    cat ~/.chunkwmrc        >> ~/.chunkwmrc.bak
    cat ~/.yabairc          >> ~/.yabairc.bak
    cat ~/.skhdrc           >> ~/.skhdrc.bak
    cat ~/.bash_profile     >> ~/.bash_profile.bak

    ln -svf 	$DOTFILES_PATH/bash	          ~/.bash_profile
    ln -svf   $DOTFILES_PATH/chunkwm        ~/.chunkwmrc
    ln -svf   $DOTFILES_PATH/yabai          ~/.yabairc
    ln -svf   $DOTFILES_PATH/skhd           ~/.skhdrc
fi

# Backup
cat ~/.vimrc        >> ~/.vimrc.bak
cat ~/.inputrc      >> ~/.inputrc.bak
cat ~/.bash_profile >> ~/.bash_profile.bak

ln -svf		$DOTFILES_PATH/vim		        ~/.vimrc
ln -svf		$DOTFILES_PATH/input		      ~/.inputrc
